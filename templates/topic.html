{% extends "base.html" %}

{% block content %}
<section class="topic">
    <h1>{{ topic.title }}</h1>
<ul>
    {% for post in posts %}
    <li>
        <strong>{{ post.author }}:</strong> {{ post.message }}
        <!-- Add comments functionality here -->
    </li>
    {% endfor %}
</ul>
<form id="addPostForm">
    <input type="text" id="author" placeholder="Your Name">
    <textarea id="message" placeholder="Your Message"></textarea>
    <button type="submit">Add Post</button>
</form>

    <h2>{{ topic.title }}</h2>
    <p>{{ topic.description }}</p>

    <!-- Списък с публикации -->
    <section id="posts">
        <h3>Posts</h3>
        {% if topic.posts %}
            <ul>
                {% for post in topic.posts %}
                <li>
                    <strong>{{ post.name }}:</strong> {{ post.message }}
                    <button onclick="deletePost({{ topic.id }}, {{ post.id }})">Delete</button>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No posts yet. Be the first to post!</p>
        {% endif %}
    </section>

    <!-- Добавяне на публикация -->
    <section id="add-post">
        <h3>Add a Post</h3>
        <form id="addPostForm">
            <label for="name">Your Name (optional):</label>
            <input type="text" id="name" name="name" placeholder="Enter your name">
            <br>
            <label for="message">Your Message:</label>
            <textarea id="message" name="message" placeholder="Write your message here" rows="4" required></textarea>
            <br>
            <button type="submit">Add Post</button>
        </form>
    </section>

    <!-- Секция за коментари -->
<section class="comments">
    <h2>Comments</h2>
    <ul id="comments-list">
        {% if topic.comments %}
            {% for comment in topic.comments %}
                <li><strong>{{ comment.author }}:</strong> {{ comment.text }}</li>
            {% endfor %}
        {% else %}
            <li>No comments yet. Be the first to comment!</li>
        {% endif %}
    </ul>
</section>

<section class="add-comment">
    <h3>Add a Comment</h3>
    <form id="addCommentForm">
        <label for="name">Your Name:</label>
        <input type="text" id="name" name="name" placeholder="Enter your name">
        <br>
        <label for="comment">Comment:</label>
        <textarea id="comment" name="comment" placeholder="Write your comment here" rows="4" required></textarea>
        <br>
        <button type="submit">Submit</button>
    </form>
</section>


<script src="{{ url_for('static', filename='js/forum.js') }}"></script>

<script>
    function deletePost(topicId, postId) {
        fetch(`/api/delete-post/${topicId}/${postId}`, {
            method: "DELETE",
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Post deleted successfully.");
                location.reload();
            } else {
                alert(data.error || "An error occurred.");
            }
        });
    }

    function deleteComment(topicId, commentId) {
        fetch(`/api/delete-comment/${topicId}/${commentId}`, {
            method: "DELETE",
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Comment deleted successfully.");
                location.reload();
            } else {
                alert(data.error || "An error occurred.");
            }
        });
    }
</script>
{% endblock %}
